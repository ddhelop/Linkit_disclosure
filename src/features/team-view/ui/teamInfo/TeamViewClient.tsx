'use client'
import { getTeamAnnouncements } from '@/features/team/api/teamApi'
import { Announcement } from '@/features/team/types/team.types'
import Link from 'next/link'
import { usePathname } from 'next/navigation'
import { useEffect, useState } from 'react'
import TeamInfo from './TeamInfo'

export default function TeamViewClient({ teamName }: { teamName: string }) {
  const [announcements, setAnnouncements] = useState<Announcement[]>([])

  useEffect(() => {
    const fetchAnnouncements = async () => {
      try {
        const response = await getTeamAnnouncements(teamName)
        setAnnouncements(response.result.teamMemberAnnouncementItems)
      } catch (error) {
        console.error('Failed to fetch announcements:', error)
      }
    }

    fetchAnnouncements()
  }, [teamName])
  const pathname = usePathname()

  // 선택된 메뉴의 스타일
  const selectedStyle = 'flex cursor-pointer rounded-xl px-6 py-4 text-sm text-grey90 bg-grey20 font-semibold '
  // 기본 메뉴 스타일
  const defaultStyle = 'flex cursor-pointer rounded-xl px-6 py-4 text-sm text-grey60 hover:bg-grey20'

  // /team/{teamName}/log/{id} 또는 /team/{teamName}/recruit/{id} 패턴 매칭
  const pattern = /^\/team\/[^/]+\/(log|recruit)\/[^/]+$/

  if (pathname && pattern.test(pathname)) {
    return <></> // 해당 패턴에 맞으면 빈 컴포넌트 반환
  }

  return (
    <div className="flex flex-col">
      {/* 그라데이션 영역 */}
      <div
        className="flex flex-col px-5 py-8 lg:px-[7.12rem]"
        style={{ background: 'linear-gradient(180deg, #D3E1FE -16.67%, #FFFFFF 100%)' }}
      >
        <TeamInfo teamName={teamName} />
        {/* 팀 정보 영역 - 가로 스크롤을 위한 컨테이너 */}
        <div className="webkit-scrollbar-hide w-full overflow-x-auto [&::-webkit-scrollbar]:hidden">
          <div className="flex min-w-max pt-12 text-sm md:gap-6 md:text-base lg:pt-[4.69rem]">
            <div className="relative">
              <Link href={`/team/${teamName}/log`} className={pathname.includes('/log') ? selectedStyle : defaultStyle}>
                팀 로그
              </Link>
              {announcements.length == 0 && (
                <div className="absolute left-0 top-0 -translate-y-full pb-1">
                  <CreateLogAndMeetMoreApplicants />
                </div>
              )}
            </div>
            <Link
              href={`/team/${teamName}/recruit`}
              className={pathname.includes('/recruit') ? selectedStyle : defaultStyle}
            >
              모집 공고
            </Link>
            <Link
              href={`/team/${teamName}/members`}
              className={pathname.includes('/members') ? selectedStyle : defaultStyle}
            >
              팀 구성원
            </Link>
            <Link
              href={`/team/${teamName}/products`}
              className={pathname.includes('/products') ? selectedStyle : defaultStyle}
            >
              프로덕트
            </Link>
            <Link
              href={`/team/${teamName}/history`}
              className={pathname.includes('/history') ? selectedStyle : defaultStyle}
            >
              연혁
            </Link>
          </div>
        </div>
      </div>
    </div>
  )
}

function CreateLogAndMeetMoreApplicants() {
  return (
    <svg width="195" height="34" viewBox="0 0 195 34" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path
        opacity="0.9"
        fillRule="evenodd"
        clipRule="evenodd"
        d="M13.5 0C6.04416 0 0 6.04416 0 13.5C0 20.9558 6.04416 27 13.5 27H33.224C33.3497 27 33.468 27.0591 33.5436 27.1595L38.5308 33.7876C38.6108 33.8939 38.7704 33.8939 38.8504 33.7876L43.8377 27.1595C43.9132 27.0591 44.0316 27 44.1573 27H181.5C188.956 27 195 20.9558 195 13.5C195 6.04416 188.956 0 181.5 0H13.5Z"
        fill="url(#paint0_linear_3731_27299)"
      />
      <path
        d="M21.9961 16.8047V17.7422H12.3867V16.8047H16.6172V14.9648H13.5586V11.625H19.7227V10.1484H13.5352V9.23438H20.8242V12.5156H14.6602V14.0508H21.0703V14.9648H17.7188V16.8047H21.9961ZM31.0781 9.5625V10.6875C31.0781 12.0469 31.0781 13.5234 30.6914 15.7617L29.5547 15.6562C29.9766 13.5586 29.9766 12.0117 29.9766 10.6875V10.4766H23.7891V9.5625H31.0781ZM32.332 16.582V17.5078H22.7578V16.582H32.332ZM39.7266 10.3828C39.7266 11.7188 40.6523 12.9961 42.2578 13.5352L41.6953 14.4023C40.5059 13.9922 39.6328 13.1719 39.1758 12.1406C38.7188 13.2773 37.8105 14.168 36.5742 14.6016L35.9766 13.7344C37.6172 13.1719 38.6016 11.8242 38.6133 10.3711V10.0898H36.3047V9.1875H41.9883V10.0898H39.7266V10.3828ZM44.3086 8.49609V11.1914H45.832V12.1289H44.3086V14.8242H43.1953V8.49609H44.3086ZM44.3086 15.3398V18.9961H43.1953V16.2422H37.3711V15.3398H44.3086ZM50.1562 10.0664C50.1562 11.543 51.1055 12.8555 52.6992 13.3711L52.0898 14.2383C50.9355 13.8223 50.0859 13.0137 49.6289 11.9648C49.1719 13.166 48.2578 14.0977 46.9922 14.5547L46.3945 13.6641C48.0703 13.0898 49.043 11.6953 49.0547 10.1133V9.08203H50.1562V10.0664ZM55.1836 8.49609V14.6953H54.0703V11.543H51.8555V10.6289H54.0703V8.49609H55.1836ZM51.668 14.9883C53.8711 14.9883 55.2188 15.7148 55.2188 16.9922C55.2188 18.2578 53.8711 18.9844 51.668 18.9727C49.4648 18.9844 48.1055 18.2578 48.1172 16.9922C48.1055 15.7148 49.4648 14.9883 51.668 14.9883ZM51.668 15.8555C50.1328 15.8555 49.2188 16.2656 49.2188 16.9922C49.2188 17.6953 50.1328 18.0938 51.668 18.0938C53.2031 18.0938 54.1172 17.6953 54.1172 16.9922C54.1172 16.2656 53.2031 15.8555 51.668 15.8555ZM64.9805 8.49609V12.75H66.668V13.6758H64.9805V18.9961H63.8789V8.49609H64.9805ZM62.9648 10.1367V11.0508H56.7422V10.1367H59.332V8.63672H60.4453V10.1367H62.9648ZM59.8945 11.8242C61.3945 11.8242 62.4961 12.832 62.5078 14.2617C62.4961 15.7031 61.3945 16.6992 59.8945 16.7109C58.3828 16.6992 57.2812 15.7031 57.2812 14.2617C57.2812 12.832 58.3828 11.8242 59.8945 11.8242ZM59.8945 12.7383C59.0039 12.7383 58.3359 13.3594 58.3477 14.2617C58.3359 15.1758 59.0039 15.7852 59.8945 15.7734C60.7852 15.7852 61.4414 15.1758 61.4414 14.2617C61.4414 13.3594 60.7852 12.7383 59.8945 12.7383ZM75.668 9.50391V10.5352C75.668 11.8359 75.668 13.2891 75.2695 15.4336L74.1445 15.3164C74.5547 13.2891 74.5547 11.8008 74.5547 10.5352V10.4062H68.1797V9.50391H75.668ZM76.7461 16.6523V17.5781H67.1719V16.6523H70.8164V12.9492H71.918V16.6523H76.7461ZM85.8047 9.46875V10.3945H82.1133V15.5156C83.8711 15.5098 85.084 15.4453 86.4609 15.1758L86.5898 16.0898C85.0781 16.3711 83.8008 16.4414 81.8203 16.4414H80.9883V9.46875H85.8047ZM89.2383 8.49609V19.0195H88.125V13.1719H85.207V12.2461H88.125V8.49609H89.2383ZM102.023 8.49609V10.8047H103.547V11.7305H102.023V13.8281H100.91V8.49609H102.023ZM99.0938 9.17578V13.4883H94.1836V9.17578H99.0938ZM95.2734 10.0664V12.5977H98.0039V10.0664H95.2734ZM95.918 14.7422V17.8008C96.5332 17.7715 97.2422 17.6836 97.9102 17.4609L98.0742 18.3398C97.1016 18.668 96.1523 18.7148 95.3672 18.7148H94.8281V14.7422H95.918ZM103.008 14.8594V15.6797H97.7109V14.8594H99.832V13.9805H100.922V14.8594H103.008ZM100.359 16.0195C101.52 16.0312 102.34 16.582 102.34 17.4961C102.34 18.4102 101.52 18.9727 100.359 18.9727C99.1758 18.9727 98.3672 18.4102 98.3789 17.4961C98.3672 16.582 99.1758 16.0312 100.359 16.0195ZM100.359 16.793C99.7734 16.8047 99.3633 17.0625 99.3633 17.4961C99.3633 17.9414 99.7734 18.2109 100.359 18.2109C100.934 18.2109 101.344 17.9414 101.344 17.4961C101.344 17.0625 100.934 16.8047 100.359 16.793ZM113.719 13.9805V14.8711H104.145V13.9805H113.719ZM112.641 17.8711V18.7734H105.352V15.7266H106.477V17.8711H112.641ZM108.926 8.84766C111.199 8.83594 112.676 9.63281 112.676 10.9453C112.676 12.2695 111.199 13.0664 108.926 13.0781C106.641 13.0664 105.176 12.2695 105.176 10.9453C105.176 9.63281 106.641 8.83594 108.926 8.84766ZM108.926 9.73828C107.32 9.73828 106.312 10.1953 106.324 10.9453C106.312 11.7188 107.32 12.1641 108.926 12.1641C110.531 12.1641 111.527 11.7188 111.527 10.9453C111.527 10.1953 110.531 9.73828 108.926 9.73828ZM121.312 11.5898C121.312 13.3477 122.461 15.1641 124.078 15.8555L123.469 16.7227C122.232 16.1777 121.248 15.0234 120.762 13.6172C120.275 15.1172 119.285 16.3945 118.066 16.9922L117.422 16.1133C119.004 15.375 120.176 13.3945 120.188 11.5898V10.4766H117.785V9.55078H123.703V10.4766H121.312V11.5898ZM126.141 8.49609V18.9961H125.027V8.49609H126.141ZM136.547 8.50781V16.4648H135.434V15.457H133.324V14.6719H135.434V8.50781H136.547ZM136.805 17.8711V18.7734H129.223V15.6914H130.324V17.8711H136.805ZM127.77 13.3008C129.715 13.2891 132.328 13.2656 134.566 12.9844L134.637 13.7812C133.74 13.9277 132.797 14.0273 131.871 14.0859V16.1367H130.758V14.1445C129.738 14.1914 128.76 14.1973 127.91 14.1914L127.77 13.3008ZM131.203 8.90625C132.738 8.90625 133.805 9.64453 133.805 10.7578C133.805 11.8711 132.738 12.5859 131.203 12.5859C129.645 12.5859 128.59 11.8711 128.59 10.7578C128.59 9.64453 129.645 8.90625 131.203 8.90625ZM131.203 9.73828C130.266 9.72656 129.633 10.125 129.645 10.7578C129.633 11.3789 130.266 11.7656 131.203 11.7656C132.105 11.7656 132.738 11.3789 132.75 10.7578C132.738 10.125 132.105 9.72656 131.203 9.73828ZM141.844 11.5898C141.844 13.2539 142.934 15.1055 144.527 15.8555L143.895 16.7227C142.717 16.1543 141.785 14.9707 141.316 13.5938C140.83 15.0996 139.846 16.3945 138.645 16.9922L137.988 16.1133C139.582 15.3516 140.742 13.3711 140.742 11.5898V10.4766H138.375V9.55078H144.129V10.4766H141.844V11.5898ZM146.367 8.49609V12.6562H148.055V13.5938H146.367V18.9961H145.254V8.49609H146.367ZM156.809 9.42188V14.3203H151.898V9.42188H156.809ZM152.988 10.3242V13.4414H155.719V10.3242H152.988ZM159.738 8.48438V11.625H161.262V12.5625H159.738V16.1836H158.625V8.48438H159.738ZM160.184 17.8711V18.7734H153.082V15.4453H154.195V17.8711H160.184ZM171.668 12.6211V13.5352H170.039V18.9844H168.926V8.49609H170.039V12.6211H171.668ZM163.359 9.51562V15.4219C164.824 15.4219 166.354 15.2988 168.023 14.9531L168.152 15.8906C166.359 16.2539 164.695 16.3477 163.125 16.3477H162.258V9.51562H163.359ZM180.961 8.49609V18.9961H179.836V8.49609H180.961ZM177.832 9.62109C177.832 12.6914 176.52 15.3633 172.922 17.0859L172.336 16.1836C175.131 14.8535 176.49 12.9609 176.707 10.5117H172.84V9.62109H177.832Z"
        fill="white"
      />
      <defs>
        <linearGradient
          id="paint0_linear_3731_27299"
          x1="0"
          y1="0"
          x2="228.272"
          y2="182.704"
          gradientUnits="userSpaceOnUse"
        >
          <stop stopColor="#4D82F3" />
          <stop offset="0.714747" stopColor="#FF345F" />
        </linearGradient>
      </defs>
    </svg>
  )
}
